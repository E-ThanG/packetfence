---
- hosts: pfservers, service_venom, nodes
  name: Rsync Git repository t/venom with /usr/local/pf/t/venom (localdev only)
  become: True

  tasks:
    - name: Synchronize Git repository t/venom with /usr/local/pf/t/venom
      ansible.posix.synchronize:
        # src is provided through test-wrapper.sh
        # as $PWD/venom (no leading slash)
        src: "{{ lookup('env', 'VENOM_ROOT_DIR') }}"
        dest: '/usr/local/pf/t/'
        archive: yes
        delete: yes
        # exclude files dynamically generated by Ansible
        rsync_opts:
          - "--exclude=vars/local.yml"

    - name: Set users term linux
      ansible.builtin.lineinfile:
        path: /etc/environment
        regexp: '^TERM='
        line: TERM=linux
      when: ansible_facts['os_family'] == "Debian"

    - name: Set root term linux
      ansible.builtin.lineinfile:
        path: /root/.profile
        regexp: '^export TERM='
        line: export TERM=linux
      when: ansible_facts['os_family'] == "Debian"

    - name: Add vim
      ansible.builtin.package:
        name: vim
        state: present
